<!-- ~/verifier_app/auth-callback.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Auth Callback</title>
  <style>
    body { font-family: Arial, sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; background:#f4f6f8; }
    .box { background:white; padding:20px 30px; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.1); text-align:center; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Authenticating...</h2>
    <p>Please wait while we sign you in.</p>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabaseUrl = 'https://nfixpojxelyrdxxqqvpb.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5maXhwb2p4ZWx5cmR4eHFxdnBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3MjI0ODYsImV4cCI6MjA3NDI5ODQ4Nn0.X6GmWOzL6NBtKKBejHjf6xQuEBeiA40EOEs4uQt7Vxw';
    const supabase = createClient(supabaseUrl, supabaseKey);

    async function checkUser() {
      const { data: { user }, error } = await supabase.auth.getUser();
      if(error || !user) { 
        alert("Authentication failed."); 
        window.location.href = "verifier-signin.html"; 
        return; 
      }

      const { data: profile, error: profileErr } = await supabase
        .from("profiles").select("role").eq("id", user.id).single();

      if(profileErr || !profile) { 
        alert("No profile found."); 
        window.location.href = "verifier-signin.html"; 
        return; 
      }

      if(profile.role === "admin") window.location.href = "dashboard.html";
      else if(profile.role === "verifier") window.location.href = "verifier-dashboard.html";
      else { 
        alert("Access denied: role not recognized."); 
        window.location.href = "verifier-signin.html"; 
      }
    }

    checkUser();
  </script>
</body>
</html>
